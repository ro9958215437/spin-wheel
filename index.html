<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spin & Jeeto</title>

<style>
body{
  margin:0;
  background:#fff3cd;
  font-family:Arial;
  text-align:center;
  position:relative;
}

h1{
  margin-top:20px;
}

#pointer{
  position:absolute;
  top:75px;
  left:50%;
  transform:translateX(-50%);
  font-size:34px;
  color:red;
  z-index:10;
}

#wheel{
  margin-top:20px;
}

button{
  margin-top:20px;
  padding:15px 30px;
  font-size:20px;
  background:#28a745;
  color:white;
  border:none;
  border-radius:10px;
}

button:disabled{
  background:gray;
}

#result{
  margin-top:20px;
  font-size:22px;
  color:#d63384;
}
</style>
</head>

<body>

<h1>ЁЯОБ рдШреБрдорд╛рдУ рдФрд░ рдЗрдирд╛рдо рдЬреАрддреЛ ЁЯОБ</h1>

<div id="pointer">ЁЯФ╗</div>

<canvas id="wheel" width="300" height="300"></canvas>

<br>
<button id="spinBtn">SPIN</button>

<p id="result"></p>

<audio id="spinSound" preload="auto">
  <source src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3" type="audio/mpeg">
</audio>

<script>
const gifts = [
  "тВ╣10 рдХреА рдЫреВрдЯ",
  "рдлреНрд░реА рдЪреЙрдХрд▓реЗрдЯ ЁЯНл",
  "тВ╣5 рдХреА рдЫреВрдЯ",
  "рдЕрдЧрд▓реА рдмрд╛рд░ рдлрд┐рд░ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ",
  "рдлреНрд░реА рдХреЛрд▓реНрдб рдбреНрд░рд┐рдВрдХ ЁЯед"
];

const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const center = 150;
const radius = 140;

let startAngle = 0;
let spinning = false;

function drawWheel(){
  const slice = 2 * Math.PI / gifts.length;
  for(let i=0;i<gifts.length;i++){
    ctx.beginPath();
    ctx.fillStyle = i % 2 === 0 ? "#ff6384" : "#36a2eb";
    ctx.moveTo(center, center);
    ctx.arc(
      center,
      center,
      radius,
      startAngle + i * slice,
      startAngle + (i + 1) * slice
    );
    ctx.fill();

    ctx.save();
    ctx.translate(center, center);
    ctx.rotate(startAngle + (i + 0.5) * slice);
    ctx.fillStyle = "#fff";
    ctx.font = "14px Arial";
    ctx.textAlign = "center";
    ctx.fillText(gifts[i], radius / 2, 5);
    ctx.restore();
  }
}

drawWheel();

document.getElementById("spinBtn").addEventListener("click", function(){

  if(localStorage.getItem("spinned")){
    alert("тЭМ рдЖрдк рдкрд╣рд▓реЗ рд╣реА рд╕реНрдкрд┐рди рдХрд░ рдЪреБрдХреЗ рд╣реИрдВ");
    return;
  }

  if(spinning) return;
  spinning = true;

  const sound = document.getElementById("spinSound");
  sound.currentTime = 0;
  sound.play();

  let spinAngle = Math.random() * 360 + 1440; // min 4 rounds
  let duration = 3000;
  let start = null;

  function animate(timestamp){
    if(!start) start = timestamp;
    let progress = timestamp - start;
    let angle = spinAngle * (1 - progress / duration);
    startAngle += angle * Math.PI / 180;

    ctx.clearRect(0,0,300,300);
    drawWheel();

    if(progress < duration){
      requestAnimationFrame(animate);
    } else {
      spinning = false;
      localStorage.setItem("spinned","yes");
      document.getElementById("spinBtn").disabled = true;

      // ЁЯОп EXACT ARROW MATCHING
      const slice = 2 * Math.PI / gifts.length;

/*
 Canvas rule:
 0 rad = right side (3 o'clock)
 Arrow = top (12 o'clock) = -90┬░ = -Math.PI/2
*/
let correctedAngle = startAngle - Math.PI / 2;

// normalize angle between 0 to 2PI
let normalized = (correctedAngle % (2 * Math.PI) + 2 * Math.PI) % (2 * Math.PI);

let index = Math.floor(normalized / slice);
index = (gifts.length - index - 1) % gifts.length;

document.getElementById("result").innerText =
  "ЁЯОЙ рдЖрдкрдХреЛ рдорд┐рд▓рд╛: " + gifts[index];
    }
  }

  requestAnimationFrame(animate);
});
</script>

</body>
</html>
